<div ng-form="form" class="table-responsive">

    <!--Weights: {{ table.view.topicWeights | json }}-->

    <table class="table ps-table" id="decision-table">
        <!--Header-->
        <thead>
        <tr>
            <th ng-repeat="col in table.view.columns" ng-class=":: col.header.class">
                <div>{{:: col.header.label }}</div>
            </th>
        </tr>
        </thead>
        <!--Groups-->
        <tbody ng-repeat="group in table.view.groups" ng-init="groupIdx = $index">
        <!--Group row-->
        <tr class="table-group"
                ng-click="group.expanded.toggle();">
            <td colspan="2">
                <a href>
                    <span class="fa fa-chevron-right caret-icon"></span>
                    {{:: group.name }}</a>
            </td>
            <td class="strong center"
                    ng-click="$event.stopPropagation()">
                <div ps-slider-popover container="td" uid="slider-{{:: groupIdx }}"
                        showIf="group">
                    <a href tabindex="-1"
                            data-toggle="popover"
                            data-placement="right"
                            title="Adjust topic weights">
                        {{ table.view.topicWeights[groupIdx].weight * 100 | number:0 }}%
                    </a>

                    <form class="slider-content page-spacer" ng-cloak>
                        <slider class="no-select">
                            <slider-range model="val.weight" ng-repeat="val in table.view.topicWeights track by val.id"
                                    ng-class="{'current-range': groupIdx === $index}">
                                <div class="slider-handle">&nbsp;&nbsp;</div>
                                <div class="slider-label">{{ val.weight * 100 | number:0 }}%</div>
                            </slider-range>
                        </slider>
                        <!--<p>
                            DBG: {{groupIdx | json}}
                        </p>-->
                    </form>
                </div>
            </td>
            <!--Group grades-->
            <td ng-repeat-start="groupCol in group.grades"></td>
            <td ng-repeat-end class="strong grade">
                {{ groupCol.grade() }}
            </td>
        </tr>
        <!--Rows & cells-->
        <tr ng-show="group.expanded.on" ng-repeat="row in group.rows">
            <td class="cell" ng-repeat="cell in row.cells"
                    ng-class="[cell.type, cell.class].concat(cell.model.max() && 'winner' || '')"
                    ng-click="focusInputEl(cell)">
                <!--Label cell-->
                <div ng-if=":: cell.type === 'static' ">{{:: cell.label }}</div>
                <!--Text cell-->
                <div ng-if=":: cell.type === 'text' ">
                    <textarea class="cell-input noresize"
                            ng-model="cell.model.value"
                            ps-ctrl="table"
                            ps-table-input="cell"
                            msd-elastic></textarea>
                </div>
                <!--Number cell-->
                <div ng-if=":: cell.type === 'number' ">
                    <input type="number" class="cell-input center"
                            min="0" max="{{:: cell.max }}"
                            ng-model="cell.model.value"
                            ps-ctrl="table"
                            ps-table-input="cell"
                            ps-input-number
                            ps-tooltip="cell.model.tooltip()"
                            required
                            >
                </div>
                <!--Mandatory icon cell-->
                <div ng-if=":: cell.type === 'icon' ">
                    <span class="fa {{:: cell.label }}"></span>
                </div>
            </td>
        </tr>
        </tbody>
        <!--Footer-->
        <tfoot>
        <tr ng-if="table.view.rows.length">
            <th class="abs-container {{:: col.footer.class }}" ng-repeat="col in table.view.columns"
                    ng-class="{'winner' : col.footer.model.max()}">
                <!--Label cell-->
                <div ng-if=":: col.footer.type === 'static' ">{{:: col.footer.label }}</div>
                <!--Func cell-->
                <div ng-if=":: col.footer.type === 'func' ">
                    {{ col.footer.model.value() }}
                </div>
                <!--Winner cup-->
                <span class="fa fa-trophy winner-icon" ng-if="col.footer.model.max()"></span>
            </th>
        </tr>
        <!--Empty table row -->
        <tr class="empty-table-content"
                ng-if="!table.loading && !table.view.rows.length">
            <td colspan="6" class="text-center">
                <span class="fa fa-info-circle"></span>
                <h4>Bummer, there's nothing to compare yet.</h4>

                <h3>
                    Please add
                    <a ui-sref="^.requirements">Requirements</a> and
                    <a ui-sref="^.products">products</a>.
                </h3>
            </td>
        </tr>
        </tfoot>
    </table>
</div>
