<!DOCTYPE  html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    <title>Launching Soon</title>

    <!-- build:css css/index.css -->
    <link rel="stylesheet" href="/css/index.css">
    <!-- endbuild -->

    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">

    <!-- htmlbuild:script inline ga --><!-- /htmlbuild -->

    <!-- start Mixpanel -->
    <script type="text/javascript">(function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
    for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);
    mixpanel.init("1b09f6d60da67fe146591982ee24638b"); mixpanel.track("page load");</script>
    <!-- end Mixpanel -->

</head>
<body>

<img src="/images/bg.jpg" alt="" class="bg"/>

<section id="wrapper">
    <div id="cont">
        <!-- Logo Header -->
        <header>
            <a href="#"><img src="/images/logo.png" width="420" height="300" id="logo" alt=""/></a>
            <div class="clear"></div>
        </header>
        <section id="box">
            <div class="arrow-up"></div>
            <div id="box-top">
                <div id="before">
                    <h1>PeerSay is coming soon!</h1>
                    <p>Please register to be the first to try our service</p>
                </div>
                <div id="after-new" style="display: none">
                    <h1>Thank you for registering!</h1>
                    <p>We'll let you know when we're up and running.</p>
                </div>
                <div id="after-dup" style="display: none">
                    <h1>Hey! Welcome back!</h1>
                    <p>We'll make sure you're among the first to get on board!</p>
                </div>

                <!-- Signup -->
                <div id="form">
                    <form id="reg-form">
                        <input type="text" id="email" placeholder="Enter a Valid Email Here">
                    </form>
                    <button id="register" class="btn btn-lg btn-peersay pull-right">Register</button>
                    <div class="clear"></div>
                </div>
            </div>
            <div id="box-bottom">
            </div>
        </section>

        <!-- FOOTER -->
        <div id="footer">
            <p class="note">We are no spammers and will never share your e-mail address</p>
            <!--p class="legal"><a href="#" target="_blank" >Legal Information</a></p-->
        </div>
    </div>
</section>

<script src="/bower_components/jquery/dist/jquery.min.js"></script>

<script>
    $(function() {
        $("#register").click(addWaiting);
        $("#reg-form").submit(addWaiting);
    })
</script>
<script>
    function addWaiting()
    {
        var simple_mail_re = /\S+@\S+\.\S+/;
        var mail = document.getElementById("email").value;

        if (!simple_mail_re.test(mail)){
            alert(mail + ' is not a valid email');
            mixpanel.track("not valid email");
            return false;
        }

        var data = JSON.stringify({email: mail});
        var path = "/api/waiting-users";

        jQuery.ajax({
            url:path,
            type:"POST",
            data:data,
            contentType:"application/json; charset=utf-8",
            dataType:"json",
            success: function(res){
                mixpanel.track("success");
                console.log( res );

                // Hide all messages before choosing the one to display
                document.getElementById("form").style.visibility="hidden";
                document.getElementById("before").style.display="none";
                document.getElementById("after-new").style.display="none";
                document.getElementById("after-dup").style.display="none";

                // There is no error field --> new user added
                if (typeof res.error === 'undefined'){
                    document.getElementById("after-new").style.display="block";
                }

                // There is no status field --> A duplicate user
                if (typeof res.result === 'undefined'){
                    mixpanel.track("duplicate");
                    document.getElementById("after-dup").style.display="block";
                }
            }
        });
        return false;
    }
</script>
</body>
</html>
