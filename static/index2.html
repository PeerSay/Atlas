<!DOCTYPE  html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    <title>Launching Soon</title>

    <!-- build:css css/index.css -->
    <link rel="stylesheet" href="/css/index.css">
    <!-- endbuild -->

    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">

    <!-- htmlbuild:script inline ga --><!-- /htmlbuild -->

    <!-- htmlbuild:script inline mixpanel --><!-- /htmlbuild -->
    <script> mixpanel.track("landing page load"); </script>

</head>
<body>

<img src="/images/bg.jpg" alt="" class="bg"/>

<section id="wrapper">
    <div id="cont">
        <!-- Logo Header -->
        <header>
            <a href="#"><img src="/images/logo.png" width="420" height="300" id="logo" alt=""/></a>
            <div class="clear"></div>
        </header>
        <section id="box">
            <div class="arrow-up"></div>
            <div id="box-top">
                <div id="before">
                    <h1>PeerSay is coming soon!</h1>
                    <p>Please register to be the first to try our service</p>
                </div>
                <div id="after-new" style="display: none">
                    <h1>Thank you for registering!</h1>
                    <p>We'll let you know when we're up and running.</p>
                </div>
                <div id="after-dup" style="display: none">
                    <h1>Hey! Welcome back!</h1>
                    <p>We'll make sure you're among the first to get on board!</p>
                </div>

                <!-- Signup -->
                <div id="form">
                    <form id="reg-form">
                        <input type="text" id="email" placeholder="Enter a Valid Email Here">
                        <button type="button" id="register" class="btn btn-lg btn-peersay pull-right">Register</button>
                    </form>
                    <div class="clear"></div>
                </div>
            </div>
            <div id="box-bottom">
            </div>
        </section>

        <!-- FOOTER -->
        <div id="footer">
            <p class="note">We are no spammers and will never share your e-mail address</p>
        </div>
    </div>
</section>

<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script>
    $(function () {
        var $form = $("#reg-form").submit(addWaiting)
                .on('mixpanel', function (evt, msg) {
                    if (window.mixpanel) {
                        mixpanel.track(msg);
                    }
                });
        $("#register").click(function () {
            $form.submit();
        });

        function addWaiting() {
            var simple_mail_re = /\S+@\S+\.\S+/;
            var mail = $("#email").val().trim();
            if (!mail) { return false; }

            if (!simple_mail_re.test(mail)) {
                alert(mail + ' is not a valid email');
                $form.trigger('mixpanel', ['not valid email']);
                return false;
            }

            var data = JSON.stringify({ email: mail });
            var path = "/api/waiting-users";

            $.ajax({
                url: path,
                type: "POST",
                data: data,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (res) {
                    //console.log(res);

                    // Hide all messages before choosing the one to display
                    $form.css({visibility: 'hidden'});
                    $('#before, #after-new, #after-dup').hide();

                    // There is no error field --> new user added
                    if (!res.error) {
                        $("#after-new").show();
                        $form.trigger('mixpanel', ['success']);
                    }
                    // There is no result field --> A duplicate user
                    else if (!res.result) {
                        $("#after-dup").show();
                        $form.trigger('mixpanel', ['duplicate']);
                    }
                    else {
                        $form.trigger('mixpanel', ['unexpected']);
                    }
                },
                error: function () {
                    $form.trigger('mixpanel', ['api-error']);
                }
            });
            return false;
        }
    });
</script>
</body>
</html>
